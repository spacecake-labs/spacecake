---
interface Props {
  items: string[]
}

const { items } = Astro.props
---

<div
  class="rotating-text-container relative inline-flex items-center h-[1.2em] font-semibold leading-[var(--sl-line-height-headings,1.6)]"
  style="font-size: clamp(var(--sl-text-3xl, 1.875rem), calc(0.25rem + 5vw), var(--sl-text-6xl, 3.75rem));"
>
  <div class="rotating-text-inner absolute inset-0">
    {
      items.map((item, i) => (
        <div
          class="rotating-text-item absolute inset-0 transition-all duration-700 ease-in-out opacity-0 translate-y-full scale-[0.8] data-[state=active]:opacity-100 data-[state=active]:translate-y-0 data-[state=active]:scale-100 data-[state=exited]:opacity-0 data-[state=exited]:-translate-y-full data-[state=exited]:scale-[0.8]"
          data-index={i}
        >
          <span class="rotating-text-gradient block font-semibold bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-500 bg-clip-text text-transparent">
            {item}
          </span>
        </div>
      ))
    }
  </div>
  <span class="rotating-text-placeholder invisible font-semibold"
    >{items[0]}</span
  >
</div>

<script>
  function initRotatingText() {
    const containers = document.querySelectorAll(".rotating-text-container")

    containers.forEach((container) => {
      const items = container.querySelectorAll(".rotating-text-item")
      const itemCount = items.length
      let index = 0

      // Set initial state
      items[0].setAttribute("data-state", "active")

      setInterval(() => {
        const prevIndex = index
        index = (index + 1) % itemCount

        // Previous item exits up
        items[prevIndex].setAttribute("data-state", "exited")

        // New item enters from below
        items[index].setAttribute("data-state", "active")

        // Reset exited items to below position after transition
        setTimeout(() => {
          items.forEach((item, i) => {
            if (i !== index) {
              item.removeAttribute("data-state")
            }
          })
        }, 700)
      }, 3000)
    })
  }

  // Run on initial load
  initRotatingText()

  // Re-run after Astro page transitions
  document.addEventListener("astro:after-swap", initRotatingText)
</script>
