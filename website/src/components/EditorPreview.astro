---
import TaskTablePreview from "./TaskTablePreview.astro"
---

<div class="relative w-full mx-auto">
  <!-- Single container with outer border -->
  <div
    class="rounded-lg overflow-hidden border border-zinc-700 bg-[#0a0a0a] shadow-2xl mockup-container antialiased"
  >
    <div class="editor-layout">
      <!-- Markdown Editor Panel -->
      <div class="markdown-panel">
        <div class="toolbar-row px-4 bg-[#0a0a0a] border-b border-zinc-800">
          <div class="font-mono text-xs text-zinc-500">
            .claude/skills/rust.md
          </div>
        </div>

        <div class="markdown-content p-6 space-y-3 flex-1">
          <!-- Rendered Markdown Heading -->
          <h1 class="text-white text-3xl font-bold">Rewrite in Rust</h1>

          <!-- Rendered Markdown Subheading -->
          <!-- <h2 class="text-white text-xl font-semibold">Instructions</h2> -->

          <!-- Rendered Markdown Paragraph -->
          <p class="text-zinc-300 text-base">Make no mistakes.</p>

          <!-- Code Block with Toolbar -->
          <div class="mt-3">
            <!-- Code Block Toolbar -->
            <div
              class="flex items-center justify-between px-2 py-1 bg-[#121212] border border-zinc-700 rounded-t"
            >
              <div class="flex items-center px-2 gap-2">
                <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                <!-- <svg
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              class="text-zinc-400"
            >
              <path d="M16 18L22 12L16 6M8 6L2 12L8 18"></path>
            </svg> -->
                <!-- <div
              class="bg-zinc-800/50 text-zinc-300 px-1.5 py-0.5 rounded text-[10px] font-mono"
            >
              code
            </div> -->
              </div>
              <div class="flex items-center gap-2">
                <button
                  class="typescript-btn flex items-center gap-1.5 bg-zinc-800/70 hover:bg-zinc-800 border border-zinc-700 text-white rounded transition-colors cursor-pointer"
                >
                  typescript
                  <svg
                    width="10"
                    height="10"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                    class="text-zinc-400"
                  >
                    <path d="M4 6l4 4 4-4H4z"></path>
                  </svg>
                </button>
                <button
                  class="text-zinc-500 hover:text-white transition-colors p-0.5 cursor-pointer"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Code Block Content -->
            <div
              class="code-content px-0 py-2 font-mono text-xs bg-[#0a0a0a] rounded-b border border-t-0 border-zinc-700 leading-relaxed"
            >
              <div>
                <!-- Line 1 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">1</span
                  >
                  <div style="padding-left: 0px">
                    <span class="text-[#ff7b72]">import</span> &#123; <span
                      class="text-[#e6edf3]">ToolLoopAgent</span
                    > &#125; <span class="text-[#ff7b72]">from</span>
                    <span class="text-[#a5d6ff]">'ai'</span>;
                  </div>
                </div>
                <!-- Line 2 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">2</span
                  >
                  <div style="padding-left: 0px">
                    <span class="text-zinc-600"></span>
                  </div>
                </div>
                <!-- Line 3 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">3</span
                  >
                  <div style="padding-left: 0px">
                    <span class="text-[#ff7b72]">const</span>
                    <span class="text-[#e6edf3]">agent</span> = <span
                      class="text-[#ff7b72]">new</span
                    >
                    <span class="text-[#ffa657]">ToolLoopAgent</span>(&#123;
                  </div>
                </div>
                <!-- Line 4 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">4</span
                  >
                  <div style="padding-left: 24px">
                    <span class="text-[#79c0ff]">model</span>: <span
                      class="text-[#a5d6ff]">"anthropic/claude-opus-4.5"</span
                    >,
                  </div>
                </div>
                <!-- Line 5 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">5</span
                  >
                  <div style="padding-left: 24px">
                    <span class="text-[#79c0ff]">instructions</span>: <span
                      class="text-[#a5d6ff]"
                      >"When you move, fall like a thunderbolt."</span
                    >,
                  </div>
                </div>
                <!-- Line 6 -->
                <div class="flex gap-3">
                  <span class="text-zinc-600 text-right w-6 select-none">6</span
                  >
                  <div style="padding-left: 0px">&#125;);</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Terminal Panel -->
      <div class="terminal-panel">
        <div
          class="toolbar-row flex items-center justify-between px-4 bg-[#0a0a0a] border-b border-zinc-800"
        >
          <div class="flex items-center gap-2 text-xs font-mono">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-emerald-400 w-4 h-4"
              ><polyline points="4 17 10 11 4 5"></polyline><line
                x1="12"
                y1="19"
                x2="20"
                y2="19"></line></svg
            >
            <!-- <span class="text-zinc-400"> terminal </span> -->
          </div>
          <div class="toolbar-badges">
            <div
              class="toolbar-badge toolbar-badge-secondary flex items-center border border-zinc-700/50 rounded px-2 py-0.5"
            >
              <span class="text-zinc-400 text-xs font-mono whitespace-nowrap"
                >üß† 67%</span
              >
            </div>

            <div
              class="toolbar-badge toolbar-badge-secondary flex items-center border border-zinc-700/50 rounded px-2 py-0.5"
            >
              <span class="text-zinc-400 text-xs font-mono whitespace-nowrap"
                >üí∞ $4.20</span
              >
            </div>

            <div
              class="toolbar-badge toolbar-badge-primary flex items-center gap-1.5 bg-emerald-500/15 border border-emerald-500/25 rounded px-2 py-0.5"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-emerald-400 flex-shrink-0"
              >
              </div>
              <span class="text-emerald-400 text-xs font-mono whitespace-nowrap"
                >opus 4.5</span
              >
            </div>
          </div>
        </div>

        <div class="p-4 text-xs space-y-3 font-jetbrains flex-1 bg-[#0a0a0a]">
          <div class="border border-orange-500 rounded p-3 space-y-2">
            <div class="text-orange-400 border-b border-orange-900 pb-2">
              ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ Claude Code ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            </div>
            <div class="space-y-1 text-zinc-300">
              <div class="text-white font-medium">Welcome back Taylor!</div>
              <div class="flex items-center gap-2">
                <div class="text-orange-400 text-base">ü¶Ä</div>
                <div class="text-xs text-zinc-500">Opus 4.5 ¬∑ Claude Pro</div>
              </div>
              <div class="text-xs text-zinc-500 terminal-path-text">
                <span class="block truncate"
                  >taylor@spacecake.ai's Organization</span
                >
                <span class="block truncate">~/Documents/GitHub/spacecake/</span
                >
              </div>
            </div>
            <div class="border-t border-orange-900 pt-2 space-y-1">
              <div class="text-emerald-400 text-xs font-medium">
                Tips for getting started
              </div>
              <div class="text-zinc-500 text-xs">
                Run ./init to create a CLAUDE.md file with instructions for
                Claude
              </div>
              <div class="text-xs mt-2">
                <span class="text-orange-400">Recent activity</span>
                <div class="text-zinc-600">No recent activity</div>
              </div>
            </div>
          </div>

          <!-- Terminal Prompt with Typing Animation -->
          <div class="flex items-center gap-2 text-zinc-400">
            <span class="text-purple-400 font-bold">‚ùØ</span>
            <span class="text-orange-400">‚ñ†</span>
            <span class="text-zinc-400" id="terminal-text"></span>
            <span
              class="inline-block w-2 h-4 bg-white opacity-100"
              id="terminal-cursor"></span>
          </div>

          <div class="text-zinc-600 text-xs pt-2">? for shortcuts</div>
        </div>
      </div>
    </div>

    <!-- Task Table - Desktop Only -->
    <div class="task-panel-desktop">
      <TaskTablePreview embedded />
    </div>
  </div>
</div>

<style>
  /* Task panel - hidden on mobile, shown on desktop */
  .task-panel-desktop {
    display: none;
    border-top: 1px solid #3f3f46; /* zinc-700 */
  }

  @media (min-width: 550px) {
    .task-panel-desktop {
      display: block;
    }
  }

  /* Side-by-side layout for markdown and terminal panels */
  .editor-layout {
    display: flex;
    flex-direction: column;
  }

  .markdown-panel,
  .terminal-panel {
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .markdown-panel {
    border-bottom: 1px solid #3f3f46; /* zinc-700 */
  }

  /* Content areas fill available space */
  .markdown-content {
    background: #0a0a0a;
    flex: 1;
    min-height: 0;
  }

  /* Toolbar rows must be exactly the same height */
  .toolbar-row {
    height: 32px;
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  @media (min-width: 550px) {
    .editor-layout {
      flex-direction: row;
      align-items: stretch;
    }

    .editor-layout > * {
      flex: 1;
      min-width: 0;
    }

    .markdown-panel {
      border-bottom: none;
      border-right: 1px solid #3f3f46; /* zinc-700 */
    }

    /* Ensure both panels have equal height */
    .markdown-panel,
    .terminal-panel {
      display: flex;
      flex-direction: column;
    }
  }

  /* Override Starlight typography styles */
  .mockup-container {
    font-family: var(--sl-font);
    line-height: 1.5 !important;
  }

  .mockup-container h1 {
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.2 !important;
  }

  .mockup-container h2 {
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.3 !important;
  }

  .mockup-container p {
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.5 !important;
  }

  /* Force code block text to stay light in both themes */
  .mockup-container .code-content {
    color: #e4e4e7 !important; /* zinc-200 */
    white-space: nowrap;
    overflow-x: hidden;
  }

  .mockup-container .code-content .flex {
    flex-wrap: nowrap;
  }

  .mockup-container .code-content .select-none {
    flex-shrink: 0;
  }

  /* Force Tailwind spacing utilities to work */
  .mockup-container .space-y-3 > * + * {
    margin-top: 0.75rem !important;
  }

  .mockup-container .space-y-2 > * + * {
    margin-top: 0.5rem !important;
  }

  .mockup-container .space-y-1 > * + * {
    margin-top: 0.25rem !important;
  }

  .mockup-container .mt-3 {
    margin-top: 0.75rem !important;
  }

  .mockup-container .mt-2 {
    margin-top: 0.5rem !important;
  }

  .mockup-container .pb-2 {
    padding-bottom: 0.5rem !important;
  }

  .mockup-container .pt-2 {
    padding-top: 0.5rem !important;
  }

  .font-mono {
    font-family: var(--sl-font-mono) !important;
  }

  .font-jetbrains {
    font-family: var(--sl-font-jetbrains) !important;
  }

  .typescript-btn {
    font-family: var(--sl-font-mono) !important;
    font-size: 11px !important;
    line-height: 1 !important;
    padding: 3px 8px !important;
  }

  .toolbar-badges {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: nowrap;
    flex-shrink: 0;
  }

  .toolbar-badge {
    flex-shrink: 0;
    white-space: nowrap;
  }

  /* Hide secondary badges at narrow widths */
  @media (max-width: 700px) {
    .toolbar-badge-secondary {
      display: none;
    }
  }

  /* Terminal panel text truncation */
  .terminal-path-text {
    min-width: 0;
    overflow: hidden;
  }

  .terminal-path-text .truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .terminal-path-text .block {
    display: block;
  }
</style>

<script>
  let typingInterval: ReturnType<typeof setInterval> | null = null
  let cursorInterval: ReturnType<typeof setInterval> | null = null

  function initTerminal() {
    const textElement = document.getElementById("terminal-text")
    const cursorElement = document.getElementById("terminal-cursor")
    const terminalContent = "edit <filepath> to..."

    if (!textElement || !cursorElement) return

    // Cleanup existing intervals
    if (typingInterval) clearInterval(typingInterval)
    if (cursorInterval) clearInterval(cursorInterval)

    // Reset content
    textElement.textContent = ""
    cursorElement.classList.remove("opacity-0")
    cursorElement.classList.add("opacity-100")

    // Typing animation
    let currentIndex = 0
    typingInterval = setInterval(() => {
      if (currentIndex <= terminalContent.length) {
        textElement.textContent = terminalContent.slice(0, currentIndex)
        currentIndex++
      } else {
        if (typingInterval) clearInterval(typingInterval)
      }
    }, 100)

    // Cursor blinking (toggle opacity)
    cursorInterval = setInterval(() => {
      cursorElement.classList.toggle("opacity-0")
      cursorElement.classList.toggle("opacity-100")
    }, 500)
  }

  // Initialize on load
  initTerminal()

  // Re-initialize when navigating with View Transitions
  document.addEventListener("astro:page-load", initTerminal)
</script>
